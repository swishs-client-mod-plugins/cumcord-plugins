(function(q,f,t,p,K,g,n){"use strict";function Z(e){if(e&&e.__esModule)return e;var o=Object.create(null);return e&&Object.keys(e).forEach(function(r){if(r!=="default"){var a=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(o,r,a.get?a:{enumerable:!0,get:function(){return e[r]}})}}),o.default=e,Object.freeze(o)}var s=Z(q),J=()=>p.injectCSS(".reaction-notifications-body{display:grid;grid-gap:12px;padding:8px 20px;align-items:center;border-radius:0;grid-template-columns:32px auto 40px}.reaction-notifications-username{flex-grow:1;cursor:pointer;font-weight:500;text-overflow:ellipsis;color:var(--text-normal)}.reaction-notifications-container{position:relative;background-color:var(--background-primary)}.reaction-notifications-message{padding:16px 16px 4px 0}.reaction-notifications-username:hover{text-decoration:underline}.reaction-notifications-first-message{border-radius:8px 8px 0 0}.reaction-notifications-last-reaction{border-radius:0 0 8px 8px}");n.findByDisplayName("Text");const W=n.findByDisplayName("Slider"),C=n.findByProps("DropdownSizes"),X=n.findByDisplayName("Divider");n.findByDisplayName("FormText");const Y=n.findByDisplayName("Speaker"),Q=n.findByDisplayName("TextInput"),h=n.findByDisplayName("FormTitle"),m=n.findByDisplayName("SwitchItem"),S=n.findByProps("soundRow");var w=()=>(f.useNest(t.persist),s.createElement(s.Fragment,null,s.createElement(h,null,"INBOX"),s.createElement(m,{onChange:()=>t.persist.store.disableInbox=!t.persist.ghost.disableInbox,value:t.persist.ghost.disableInbox,hideBorder:!0},"Disable recent reactions in inbox (requires reload)"),s.createElement(m,{note:"Add reactions to the inbox even if the reaction is from the current channel.",onChange:()=>t.persist.store.addFromCurrent=!t.persist.ghost.addFromCurrent,value:t.persist.ghost.addFromCurrent,disabled:t.persist.ghost.disableInbox},"Add to inbox from current channel"),s.createElement(h,null,"MESSAGE CACHING"),s.createElement(m,{note:"Will log every message ID sent from you so the plugin can manually request the message if it isn't cached.",onChange:()=>t.persist.store.enableMessageCache=!t.persist.ghost.enableMessageCache,value:t.persist.ghost.enableMessageCache,hideBorder:!0},"Enable Forced Message Cache"),s.createElement(C,{color:C.Colors.BRAND_NEW,size:C.Sizes.MEDIUM,onClick:()=>t.persist.store.messageStore={}},"Clear Message Cache (",Object.keys(t.persist.ghost.messageStore).reduce((e,o)=>e+=t.persist.ghost.messageStore[o].length,0),")"),s.createElement("div",{style:{paddingBottom:"20px"}}),s.createElement(X,null),s.createElement(h,null,"NOTIFICATIONS"),s.createElement(m,{onChange:()=>t.persist.store.disableNotifications=!t.persist.ghost.disableNotifications,value:t.persist.ghost.disableNotifications,hideBorder:!0},"Disable notifications"),s.createElement(m,{onChange:()=>t.persist.store.sendInDND=!t.persist.ghost.sendInDND,value:t.persist.ghost.sendInDND,disabled:t.persist.ghost.disableNotifications,hideBorder:!0},"Send notifications while in DND mode"),s.createElement(m,{note:"Send notifications even if the reaction is from the current channel.",onChange:()=>t.persist.store.sendInCurrent=!t.persist.ghost.sendInCurrent,value:t.persist.ghost.sendInCurrent,disabled:t.persist.ghost.disableNotifications},"Send notifications from the current channel"),s.createElement(h,{className:`${S.notificationSound} ${S.soundRow}`},"AUDIO",s.createElement("div",{className:S.soundIcon,onClick:()=>{if(!t.persist.ghost.createSound)return;const e="https://discord.com/assets/dd920c06a01e5bb8b09678581e29d56f.mp3",o=new Audio(t.persist.ghost.mentionSound?e:t.persist.ghost.link);o.volume=t.persist.ghost.volume,o.play()}},s.createElement(Y,{width:15,height:24}))),s.createElement(m,{note:'Psst! You can preview the sound by hovering over "Audio" and clicking on the speaker!',onChange:()=>t.persist.store.createSound=!t.persist.ghost.createSound,value:t.persist.ghost.createSound,hideBorder:!0},"Create sound on notification"),s.createElement(m,{onChange:()=>t.persist.store.mentionSound=!t.persist.ghost.mentionSound,value:t.persist.ghost.mentionSound,disabled:!t.persist.ghost.createSound,hideBorder:!0},"Use default mention sound"),s.createElement(h,null,"AUDIO LINK"),s.createElement(Q,{placeholder:"https://cdn.discordapp.com/attachments/829809799553482764/847584766148345866/society.mp3",className:"codeRedemptionInput-fKM0fu",onChange:e=>t.persist.store.link=e,disabled:t.persist.ghost.mentionSound||!t.persist.ghost.createSound,value:t.persist.ghost.link}),s.createElement("div",{style:{paddingBottom:"20px"}}),s.createElement(h,null,"VOLUME (DEFAULT IS 100%)"),s.createElement(W,{initialValue:t.persist.ghost.volume*100,minValue:0,maxValue:100,disabled:!t.persist.ghost.createSound,onValueChange:e=>t.persist.store.volume=e/100}),s.createElement("div",{style:{paddingBottom:"20px"}})));const M=[];var u={patch:e=>e&&M.push(e),unpatchAll:()=>M.forEach(e=>e())};const R=n.findByDisplayName("Text"),k=n.findByDisplayName("Reactions"),D=n.findByDisplayNameAll("Header")[1],N=n.find(e=>e.prototype?.getGuildId),ee=n.findByDisplayName("Checkmark"),A=n.findByDisplayName("FormDivider"),$=n.findByProps("AnimatedAvatar").default,te=n.findByDisplayName("CircleIconButton"),I=n.findByProps("MenuGroup","MenuItem"),se=n.findByDisplayNameAll("EmojiSmile")[1],ne=n.findByDisplayName("InboxEmptyStateStars"),P=n.find(e=>e.prototype?.toDate&&e.prototype.month),re=n.findByDisplayName("RecentsChannelHeader"),B=n.find(e=>e.type?.displayName==="ChannelMessage"),T=n.find(e=>e.prototype?.getReaction&&e.prototype.isSystemDM),{transitionTo:O}=n.findByProps("transitionTo"),{openUserProfileModal:j}=n.findByProps("openUserProfileModal"),{openContextMenu:oe,closeContextMenu:ie}=n.findByProps("openContextMenu"),d={Sizes:n.findByProps("size10"),Button:n.findByProps("size32"),Stars:n.findByProps("stars","protip"),Colors:n.findByProps("colorStatusGreen")},F=()=>s.createElement("div",{className:"reaction-notifications-container",style:{borderRadius:"8px",marginTop:"8px",marginLeft:"16px"}},s.createElement(B,{channel:new N({id:"uwu"}),message:new T({content:"rape",timestamp:new P("2021-09-24T22:20:42.723Z"),author:{id:"192760945766957066",username:"creatable",toString:()=>"creatable",isSystemUser:()=>!1,getAvatarURL:()=>"https://cdn.discordapp.com/avatars/192760945766957066/629d2de47aab4d95fe45d846abfb083a.webp?size=80"}}),style:{paddingTop:"8px",marginLeft:"4px",textAlign:"left",marginRight:"132px"}}),s.createElement(B,{channel:new N({id:"uwu"}),message:new T({content:"LMAO",timestamp:new P("2021-09-24T22:20:42.723Z"),author:{id:"257109471589957632",username:"Beef",toString:()=>"Beef",isSystemUser:()=>!1,getAvatarURL:()=>"https://cdn.discordapp.com/avatars/257109471589957632/d1edbec71d56736a68bc639ed7da43d0.webp?size=80"}}),style:{marginLeft:"4px",textAlign:"left",paddingBottom:"8px"}}));var y={RapeLMAO:F,NoReactions:()=>s.createElement("div",{className:d.Stars.container},s.createElement("div",{className:d.Stars.iconContainer},s.createElement(se,{className:d.Stars.icon,width:36,height:36}),s.createElement(ne,{className:d.Stars.stars})),s.createElement(D,{className:d.Stars.header,size:d.Sizes.size24},"No reactions here!"),s.createElement(R,{className:d.Colors.colorHeaderSecondary,size:d.Sizes.size12},s.createElement(R,{tag:"span",className:d.Stars.protip,color:d.Colors.colorStatusGreen,size:d.Sizes.size12},"Protip:"," "),Math.random()<.1?s.createElement(F,null):"Cumming is always funner with friends!")),ReactionCardHeader:e=>s.createElement(re,{channel:e.channel,gotoChannel:()=>{O(`/channels/${e.channel.guildId||"@me"}/${e.channel.id}/${e.message}`)}},s.createElement(te,{className:`${d.Button.button} ${d.Button.tertiary}`,onClick:()=>delete t.persist.store.reactions[e.channel.id],tooltip:"Mark as Read",icon:s.createElement(ee,{height:16,width:16})})),RenderMessage:e=>s.createElement(s.Fragment,null,e.isFirstMessage||s.createElement(A,null),s.createElement("div",{className:`reaction-notifications-message ${!e.isFirstMessage||"reaction-notifications-first-message"} reaction-notifications-container`},s.createElement(B,{message:e.message,channel:e.channel,onContextMenu:o=>oe(o,()=>s.createElement(s.Fragment,null,s.createElement(I.default,{onClose:ie},s.createElement(I.MenuItem,{label:"Jump to Message",id:"jump",action:()=>{O(`/channels/${e.channel.guildId||"@me"}/${e.channel.id}/${e.message.id}`)}}),s.createElement(I.MenuItem,{label:"Delete Message",id:"delete",action:()=>{delete t.persist.store.reactions[e.channel.id][e.message.id]}}))))}))),ReactionCardBody:e=>s.createElement(s.Fragment,null,s.createElement(A,null),s.createElement("div",{className:`reaction-notifications-body ${!e.isLastReaction||"reaction-notifications-last-reaction"} reaction-notifications-container`},s.createElement($,{src:e.user.getAvatarURL(),size:$.Sizes.SIZE_32,onClick:()=>j({userId:e.user.id})}),s.createElement("div",{className:"reaction-notifications-username",onClick:()=>j({userId:e.user.id})},e.user.username,"#",e.user.discriminator),s.createElement("div",{className:"reaction-notifications-reactions"},s.createElement(k,{channel:new N({id:"uwu"}),message:{getChannelId:()=>"uwu!",reactions:[{count:e.count,emoji:e.reaction.emoji,me:!1}]},disableReactionCreates:!0,disableReactionUpdates:!0}))))};const{getGuild:ae}=n.findByProps("getGuild"),{getChannel:de}=n.findByProps("getDMUserIds"),{fetchMessages:ce}=n.findByProps("sendMessage"),{transitionTo:le}=n.findByProps("transitionTo"),{getChannelId:U}=n.findByProps("getVoiceChannelId"),{showNotification:me}=n.findByProps("showNotification"),{getStatus:he}=n.findByProps("getStatus","getPresence"),{getMessage:z}=n.findByProps("getMessage","getMessages"),{AdvancedScrollerThin:ue}=n.findByProps("AdvancedScrollerThin"),{getUser:fe,getCurrentUser:pe}=n.findByProps("getUser","getCurrentUser"),ge=n.findByProps("Header","Item"),v=n.findByProps("getFullState","settings"),_=n.find(e=>e.default?.displayName==="RecentsHeader"),ye=n.find(e=>e.default?.displayName==="RecentMentions"),Ee=n.find(e=>e.default?.displayName==="UnreadMessages"),x={...n.findByProps("tab","header"),...n.findByProps("messageContainer")},Ce=(e,o)=>({channelId:e,jump:{flash:!0,messageId:o},limit:1}),L=async e=>{const o=pe().id;if(e?.userId!==o){let r=z(e.channelId,e.messageId);if(!r&&t.persist.ghost.enableMessageCache&&t.persist.ghost.messageStore[e.channelId]?.includes(e.messageId)&&(await ce(Ce(e.channelId,e.messageId)),await new Promise(a=>setTimeout(a,300)),r=z(e.channelId,e.messageId)),r?.author.id===o){const a=fe(e.userId),i=de(e.channelId),c=ae(i.guild_id);if((t.persist.ghost.addFromCurrent||U()!==i.id)&&(t.persist.ghost.disableInbox||(t.persist.ghost.reactions[i.id]||(t.persist.store.reactions[i.id]={channel:i}),t.persist.ghost.reactions[i.id][r.id]||(t.persist.store.reactions[i.id][r.id]=[r]),t.persist.store.reactions[i.id][r.id].push({reaction:e,guild:c,user:a,message:r,channel:i,count:r.reactions.find(l=>l.emoji.name===e.emoji.name&&l.emoji.id===e.emoji.id).count}))),t.persist.ghost.disableNotifications)return;if((t.persist.ghost.sendInCurrent||U()!==i.id)&&(t.persist.ghost.sendInDND||he(o)!=="dnd")&&(me(a.getAvatarURL(),`${a.username}${c?` (#${i.name}, ${c.name})`:""}`,`New Reaction: ${e.emoji.name}`,{onClick:()=>le(path)}),t.persist.ghost.createSound)){const l="https://discord.com/assets/dd920c06a01e5bb8b09678581e29d56f.mp3",E=new Audio(t.persist.ghost.mentionSound?l:t.persist.ghost.link);E.volume=t.persist.ghost.volume,E.play()}}}},G=e=>{!t.persist.ghost.enableMessageCache||!e.sendMessageOptions||e.optimistic||(t.persist.ghost.messageStore[e.channelId]||(t.persist.store.messageStore[e.channelId]=[]),t.persist.store.messageStore[e.channelId].push(e.message.id))},H=()=>{const e=t.persist.ghost.reactions,o=[[]];return f.useNest(t.persist),Object.keys(e).forEach((r,a)=>{if(o[a]||o.push([]),Object.keys(e[r]).length===1){delete e[r];return}o[a].push(s.createElement(y.ReactionCardHeader,{channel:e[r].channel,message:e[r][Object.keys(e[r])[1]][0].id})),Object.keys(e[r]).forEach((i,c,l)=>{if(i==="channel")return;const E=c===1,Be=c===l.length-1;o[a].push(s.createElement(y.RenderMessage,{isFirstMessage:E,message:e[r][i][0],channel:e[r].channel})),e[r][i].forEach((ve,V,b)=>{if(V===0)return;b.length===1&&delete e[r][i];const xe=Be&&(b.length===1||V===b.length-1);o[a].push(s.createElement(y.ReactionCardBody,{...ve,isLastReaction:xe}))})})}),s.createElement(K.ErrorBoundary,null,s.createElement(ue,{fade:!0},o[0].length?o.map(r=>s.createElement("div",{className:x.container},r)):s.createElement(y.NoReactions,null)))},Se=()=>{const e=({__originalType:o,...r})=>{const a=o.call(void 0,r);try{v.settings.inbox.currentTab===3&&(a.props.children[1]=s.createElement(H,null))}catch(i){console.error("RecentMentions patch failed:",i)}return a};u.patch(p.after("default",ye,(o,r)=>{Object.assign(r.props,{__originalType:r.type}),r.type=e})),u.patch(p.after("default",Ee,(o,r)=>{v.settings.inbox.currentTab===3&&(r.props.children[1]=s.createElement(H,null))}))},Ne=()=>{const e=({__originalType:o,...r})=>{const a=o.call(void 0,r);if(r.tab!==3)return a;try{const i=f.findInReactTree(a,c=>typeof c?.onClick=="function");if(!i)return a;i.onClick=()=>t.persist.store.reactions={}}catch(i){console.error("ReadAllButton patch failed:",i)}return a};u.patch(p.before("default",_,([o])=>{o.tab=v.settings.inbox.currentTab})),u.patch(p.after("default",_,([o],r)=>{const a=f.findInReactTree(r,l=>l?.onItemSelect),i=f.findInReactTree(r,l=>typeof l?.props?.onClick=="function"),c=a?.children;!Array.isArray(c)||(i&&(Object.assign(i.props,{__originalType:i.type,tab:o.tab}),i.type=e),c.push(s.createElement(ge.Item,{id:3,look:0,className:`${x.tab}${o.tab===3?` ${x.active}`:""}`},"Reactions")))}))};var Ie=()=>({onLoad(){t.persist.ghost.reactions||(t.persist.store.reactions={}),t.persist.ghost.messageStore||(t.persist.store.messageStore={});const e={link:"",volume:1,createSound:!0,mentionSound:!0,sendInCurrent:!0};for(let o in e)t.persist.ghost.hasOwnProperty(o)||(t.persist.store[o]=e[o]);g.FluxDispatcher.subscribe("MESSAGE_CREATE",G),g.FluxDispatcher.subscribe("MESSAGE_REACTION_ADD",L),t.persist.ghost.disableInbox||(u.patch(J()),Se(),Ne())},onUnload(){g.FluxDispatcher.unsubscribe("MESSAGE_CREATE",G),g.FluxDispatcher.unsubscribe("MESSAGE_REACTION_ADD",L),u.unpatchAll()},settings:s.createElement(w,null)});return Ie})(cumcord.modules.common.React,cumcord.utils,cumcord.pluginData,cumcord.patcher,cumcord.ui.components,cumcord.modules.common,cumcord.modules.webpack);
