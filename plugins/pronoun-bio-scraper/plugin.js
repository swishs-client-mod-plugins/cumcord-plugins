(function(x,p,s,i,y,O){"use strict";function z(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if(n!=="default"){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,Object.freeze(t)}var r=z(x);const v=[];var h={patch:e=>e&&v.push(e),unpatchAll:()=>v.forEach(async e=>await e()),lazyPatchContextMenu:async(e,t)=>{const n=a=>a.default&&a.default.displayName===e,o=s.find(n);if(o)t(o);else{const a=s.findByProps("openContextMenuLazy");let c=p.before("openContextMenuLazy",a,m=>{const q=m[1];return m[1]=async()=>{const J=await q(m[0]);return Q=>{const $=J(Q);return $?.type?.displayName===e&&t&&(c(),t(s.find(n)),t=!1),$}},m})}}};const{fetchProfile:N}=s.findByProps("fetchProfile"),{getUserProfile:S}=s.findByProps("getUserProfile"),{getUser:A}=s.findByProps("getUser","getCurrentUser"),f=[];var I=async e=>{!S(e.id)&&!f.includes(e.id)&&(f.push(e.id),await N(e.id),f.splice(f.length-1,1));const t=A(e.id);if(t)return L(t.bio)};const L=e=>{if(!e)return;e=e.replace(/(http(s)?:\/\/.)?(www\.)?[-a-z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-z0-9@:%_\+.~#?&//=]*)/gi,"");let t=e.match(/[a-z]+?(?:\/[a-z]+)+/i);if(!t)if(~e.indexOf("pronouns")){if(~e.indexOf("any"))return"any pronouns";if(~e.indexOf("avoid"))return"avoid pronouns, use my name";if(~e.indexOf("ask"))return"ask for pronouns"}else{if(~e.indexOf("male"))return"possibly he/him";if(~e.indexOf("female"))return"possibly she/her";if(~e.indexOf("boy"))return"possibly he/him";if(~e.indexOf("girl"))return"possibly she/her"}return t?.[0]?.toLowerCase()};/**
 * NOTICE OF LICENSE
 *
 * This source file is subject to the GNU General Public License (GPL-3.0).
 * You can find more information in the LICENSE.md file.
 * More information is also avaliable at this URL:
 * https://opensource.org/licenses/GPL-3.0
 * 
 *
 * @copyright Copyright (c) 2022 Paige Jordan
 * @license   GPL-3.0 GNU General Public License v3.0
 * @link      https://github.com/swishs-client-mod-plugins/cumcord-plugins/tree/main/plugins/pronoun-bio-scraper
 */const E={},R="https://pronoundb.org/api/v1/lookup?platform=discord&id=",_={hh:"he/him",hs:"he/she",si:"she/it",ih:"it/him",ii:"it/its",is:"it/she",hi:"he/it",ht:"he/they",sh:"she/her",shh:"she/he",th:"they/he",ti:"they/it",it:"it/they",st:"she/they",ts:"they/she",tt:"they/them",any:"any pronouns",other:"other pronouns",ask:"ask me my pronouns",avoid:"avoid pronouns, use my name"};var U=async e=>{if(E[e.id])return E[e.id];const t=await(await fetch(R+e.id)).json(),n=_[t.pronouns];return E[e.id]=n??"undefined",n},g=async e=>{if(!e)return;const t=await I(e);if(!i.persist.ghost.pronoundb)return t;let n=await U(e);n=n!=="undefined"?n:void 0;let o=t;return n&&t&&n!==t?o=`${n} | ${t} (scraped)`:o||(o=n),o};const C=s.findByProps("timestampInline");var w=({author:e})=>{const[t,n]=r.useState("still loading");return r.useEffect(async()=>{if(i.persist.ghost[e.id])return n(i.persist.ghost[e.id]);n(await g(e))}),r.createElement("span",{className:`${C.timestamp} ${C.timestampInline}`},t?`\u2022 ${t}`:"")};const T=s.findByDisplayName("SwitchItem");var b=()=>(y.useNest(i.persist),r.createElement(r.Fragment,null,r.createElement(T,{onChange:()=>i.persist.store.pronoundb=!i.persist.ghost.pronoundb,value:i.persist.ghost.pronoundb},"PronounDB Support")));const P=s.findByDisplayName("Flex"),j=s.findByDisplayName("Anchor"),l=s.findByProps("DropdownSizes"),M=s.findByProps("Sizes","Tags"),F=s.findByDisplayName("TextInput"),H=s.findByProps("anchorUnderlineOnHover"),d=s.findByProps("ModalCloseButton");let u;var G=({event:e,author:t})=>{const[n,o]=r.useState("Loading..."),a=c=>{c.key==="Enter"&&(i.persist[t]=n,e.onClose())};return r.useEffect(()=>(document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a))),console.log(u),r.useEffect(async()=>{u=await g(t)??"";const c=i.persist.ghost[t.id]?i.persist.ghost[t.id]:u;o(c)},[]),r.createElement(d.ModalRoot,{transitionState:e.transitionState,className:"pronoun-overide-modal",size:"small"},r.createElement(O.ErrorBoundary,null,r.createElement(d.ModalHeader,{separator:!1},r.createElement(P.Child,{basis:"auto",grow:1,shrink:1,wrap:!1},r.createElement(M,{tag:"h2",size:M.Sizes.SIZE_20},"Override Pronouns")),r.createElement(P.Child,{basis:"auto",grow:0,shrink:1,wrap:!1},r.createElement(d.ModalCloseButton,{onClick:e.onClose}))),r.createElement(d.ModalContent,null,r.createElement(F,{placeholder:"cum/cumself",onChange:o,value:n}),r.createElement("div",{style:{marginTop:"3px"}}),r.createElement(j,{onClick:()=>o(u),className:H.anchorUnderlineOnHover,style:{fontSize:"14px"},cursor:"pointer"},"Reset Pronouns")),r.createElement(d.ModalFooter,null,r.createElement(l,{onClick:()=>{n===u?delete i.persist.store[t.id]:i.persist.store[t.id]=n,e.onClose()},color:l.Colors.BRAND_NEW},"Change Pronouns"),r.createElement(l,{onClick:e.onClose,look:l.Looks.LINK,color:l.Colors.TRANSPARENT},"Cancel"))))};const{openModal:K}=s.findByProps("openModal","openModalLazy"),B=s.findByProps("MenuGroup","MenuItem"),W=s.find(e=>typeof e.default=="function"&&e.default.toString().includes("showAvatarPopout"));var Z=()=>({onLoad(){h.patch(p.after("default",W,([e],t)=>{const n=y.findInReactTree(t,o=>Array.isArray(o?.children)&&!o.children[0]);!n||n.children.push(r.createElement(w,{author:e.message.author}))})),h.lazyPatchContextMenu("MessageContextMenu",e=>{h.patch(p.after("default",e,([t],n)=>{y.findInReactTree(n,o=>o?.props?.id=="pronouns")||n.props.children.push(r.createElement(B.MenuGroup,null,r.createElement(B.MenuItem,{id:"pronouns",label:"Overide Pronouns",action:()=>K(o=>r.createElement(G,{event:o,author:t.message.author}))})))}))})},onUnload(){h.unpatchAll()},settings:r.createElement(b,null)});return Z})(cumcord.modules.common.React,cumcord.patcher,cumcord.modules.webpack,cumcord.pluginData,cumcord.utils,cumcord.ui.components);
