(function(v,f,E,O,l,N){"use strict";function A(r){if(r&&r.__esModule)return r;var n=Object.create(null);return r&&Object.keys(r).forEach(function(s){if(s!=="default"){var a=Object.getOwnPropertyDescriptor(r,s);Object.defineProperty(n,s,a.get?a:{enumerable:!0,get:function(){return r[s]}})}}),n.default=r,Object.freeze(n)}var e=A(v);const P=[];var u={patch:r=>r&&P.push(r),unpatchAll:()=>P.forEach(async r=>await r()),lazyPatchContextMenu:async(r,n)=>{const s=c=>c.default&&c.default.displayName===r,a=l.find(s);if(a)n(a);else{const c=l.findByProps("openContextMenuLazy");let t=f.before("openContextMenuLazy",c,i=>{const o=i[1];return i[1]=async()=>{const d=await o(i[0]);return I=>{const x=d(I);return x?.type?.displayName===r&&n&&(t(),n(l.find(s)),n=!1),x}},i})}}};const h=l.findByDisplayName("Flex"),R=l.findByDisplayName("Text"),M=l.findByDisplayName("TabBar"),D=l.findByDisplayName("Close"),T=l.findByDisplayName("Checkmark"),g=l.findByProps("ModalCloseButton"),{Permissions:m}=O.constants,y={TabBar:l.findByProps("tabBarContainer"),ReactionModal:l.findByProps("spinnerMore"),RoleMenu:l.findByProps("roleDot","sidebar")};var C=({event:r,roles:n={},permissions:s})=>{const[a,c]=e.useState(Object.keys(n)[0]);return e.createElement(g.ModalRoot,{transitionState:r.transitionState,className:y.ReactionModal.container,size:"large"},e.createElement(N.ErrorBoundary,null,s||e.createElement(g.ModalContent,null,e.createElement(M,{selectedItem:a,type:M.Types.SIDE,onItemSelect:c},Object.keys(n).map(t=>e.createElement(M.Item,{id:n[t].id,className:y.RoleMenu.row,itemType:M.Types.SIDE},e.createElement("div",{className:y.RoleMenu.roleDot,style:{backgroundColor:n[t].colorString||"#99aab5"}}),e.createElement(R,{className:y.RoleMenu.roleName},n[t].name))))),e.createElement(g.ModalContent,null,Object.keys(m).map(t=>{const i=a?n[a].permissions:s,o=n?.[a]?.permissionsDeny,d=(i&m.ADMINISTRATOR)===m.ADMINISTRATOR;return e.createElement(h,{style:{paddingLeft:"12px",paddingRight:"264px"},align:h.Align.CENTER,className:y.ReactionModal.reactorDefault},e.createElement(h.Child,{grow:0,shrink:0},(i&m[t])===m[t]&&(o?(o&m[t])!==m[t]:!0)||d?e.createElement(T,{height:24,width:24,color:"#43B581"}):e.createElement(D,{height:24,width:24,color:"#F04747"})),e.createElement(h.Child,null,e.createElement(R,null,t.charAt(0).toUpperCase()+t.slice(1).toLowerCase().replace(/_\w/g,I=>" "+I.toUpperCase().slice(1)))))}))))};const p=l.findByProps("MenuGroup","MenuItem"),{Permissions:b}=O.constants,{getGuild:j}=l.findByProps("getGuild"),{getMember:S}=l.findByProps("getMember"),{openModal:B}=l.findByProps("openModal","openModalLazy"),z=()=>{u.lazyPatchContextMenu("GuildContextMenu",r=>{u.patch(f.after("default",r,([n],s)=>{E.findInReactTree(s,a=>Array.isArray(a.children))?.children?.splice(1,0,e.createElement(e.Fragment,null,e.createElement(p.MenuSeparator,null),e.createElement(p.MenuItem,{label:"View Permissions",id:"permissions",action:()=>{B(a=>e.createElement(C,{event:a,roles:n.guild.roles}))}})))}))})},L=()=>{u.lazyPatchContextMenu("GuildChannelUserContextMenu",r=>{u.patch(f.after("default",r,([n],s)=>{const a=E.findInReactTree(s,o=>Array.isArray(o.children))?.children,c=j(n.guildId),t=S(n.guildId,n.user.id),i=c.ownerId===n.user.id?Object.values(b).reduce((o,d)=>o|d,0n):Object.values(c.roles).reduce((o,d)=>~t.roles.indexOf(d.id)?o|d.permissions:o,0n|c.roles[n.guildId].permissions);a?.splice(2,0,e.createElement(e.Fragment,null,e.createElement(p.MenuSeparator,null),e.createElement(p.MenuItem,{label:"View Permissions",id:"permissions",action:()=>{B(o=>e.createElement(C,{event:o,permissions:i}))}})))}))})},_=()=>{u.lazyPatchContextMenu("ChannelListTextChannelContextMenu",r=>{u.patch(f.after("default",r,([n],s)=>{const a=E.findInReactTree(s,t=>Array.isArray(t.children))?.children,c=Object.values(n.guild.roles).map(t=>{if(!~Object.keys(n.channel.permissionOverwrites).indexOf(t.id))return;const i={...t};return i.permissions|=n.channel.permissionOverwrites[t.id].allow,i.permissionsDeny=n.channel.permissionOverwrites[t.id].deny,i}).filter(Boolean).reduce((t,i)=>Object.assign(t,{[i.id]:i}),{});a?.splice(1,0,e.createElement(e.Fragment,null,e.createElement(p.MenuSeparator,null),e.createElement(p.MenuItem,{label:"View Permissions",id:"permissions",action:()=>{B(t=>e.createElement(C,{event:t,roles:c}))}})))}))})};var F=()=>({onLoad(){z(),L(),_()},onUnload(){u.unpatchAll()}});return F})(cumcord.modules.common.React,cumcord.patcher,cumcord.utils,cumcord.modules.common,cumcord.modules.webpack,cumcord.ui.components);
